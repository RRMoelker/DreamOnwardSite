<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>URL fragments Django | DreamOnward</title>
  <meta name="description" content="If you are a Django web developer you surely have found the need to use the sites domain name or absolute URL in a template. Django has a lot of functions an...">

  <!-- google analytics will only hit DNS on script execution, prefetch DNS -->
  <link rel="dns-prefetch" href="//www.google-analytics.com">
  <!-- google font will load additional files from other domain, prefetch DNS -->
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed" rel="stylesheet">

  <link type="text/css" rel="stylesheet" href="/assets/main-f021d588a416e00beed710bc60b3e7d8ac016a8d0eb7a5f17faa05cb145c27b4.css">
  <link type="text/css" rel="stylesheet" href="/assets/syntax-pygments-306491d01ec67c312c7391230abbf00e22dbdb2a9c283cb4cf00dc270ce28162.css">
  <link href="/assets/vendor/lightbox/css/lightbox.min.css" rel="stylesheet">
  <link rel="canonical" href="https://dreamonward.com/2014/11/28/url-fragments-django/">
</head>


  <body>
    <header class="banner" role="banner">
  <nav class="container site-nav">

    <a class="site-logo-space" href="/">
      <div class="site-logo">
        <img src="/assets/img/DreamOnward_logo_v1-800x800.png" height="60" srcset="/assets/img/DreamOnward_logo_v1-800x800.png 1x, /assets/img/DreamOnward_logo_v1-800x800.png 2x, /assets/img/DreamOnward_logo_v1-800x800.png 3x"> 
      </div>
      <div class="site-header-titles">
        <h1 class="site-header-title">DreamOnward</h1>
        <span class="site-header-subtitle">Full stack web development</span>
      </div>
    </a>

    <ul>
      
        
        <li>
          <a href="/projects">Projects</a>
        </li>
        
      
    </ul>
  </nav>


</header>


    <main class="page-content" aria-label="Content">
    <article class="post container" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">URL fragments Django</h1>
    <p class="post-meta">
    	<time datetime="2014-11-28T00:00:00+00:00" itemprop="datePublished">Nov 28, 2014</time>
	</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>If you are a Django web developer you surely have found the need to use the sites domain name or absolute URL in a template. Django has a lot of functions and META keywords to do just that, but the features are spread out and lack a common interface. So, we have made a <a href="https://github.com/RRMoelker/django-full-url">small tool/library</a> to simplify the process of getting what you need from the <a href="http://en.wikipedia.org/wiki/URI_scheme#Examples">complex URL/URI schema</a>.</p>

<h2 id="what-the-fuzz">What the fuzz?</h2>
<p>So what exactly is the problem?Why would you need the full URL? And why not just always use relative paths, no domain needed?</p>

<p>Well first, say you want to share the current page on a social network. And you don’t want bloated prefab share buttons but use static share buttons. You will need to get the current URL in you template code to use in the share link. And not just the relative path, but the full URL,
say: <strong>http://example.com/news/2014/11/awesome-news/</strong> instead of <strong>/news/2014/11/awesome-news/</strong>. Getting that URL is surprisingly poorly documented.</p>

<p>Or say you want to send your users and email with your brand image in the header. If you simple use</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">static</span> <span class="s2">"my_app/myexample.jpg"</span> <span class="cp">%}</span></code></pre></figure>

<p>you’ll end up with a broken image if the user views the email outside of your web page. Why, because in their web mail viewer or native app the domain name is unkown. Solution? Add the domain name in front of the image path.</p>

<p>So our little library should make it easy to get an URL in it’s entirety or just some parts of it. Say the user is looking at the URL: <strong>http://localhost:8000/news/2014/?sort=ascending#item2</strong></p>

<p>Using our <a href="https://github.com/RRMoelker/django-full-url">library</a> you can easily obtain the different parts such as:</p>

<ul>
  <li>protocol: http://</li>
  <li>domain: localhost:8000</li>
  <li>port: 8000</li>
  <li>path: /news/2014/</li>
  <li>query: sort=ascending</li>
  <li>full_url: /news/2014/?sort=ascending</li>
  <li>absolute_uri: http://localhost:8000/news/2014/?sort=ascending</li>
</ul>

<p>To actually get these URL parts install the plugin and use either the context manager method or add the variables to the context yourself. For the rest of the text, we’ll assume you are using the context manager.</p>

<h2 id="full-url">Full URL</h2>
<p>If you want to share the current page you probably want to have access to the full URL in your template. If you want the protocol, domain and path <strong>without get parameters</strong> use:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span><span class="nv">url_parts.protocol</span><span class="cp">}}{{</span><span class="nv">url_parts.domain</span><span class="cp">}}{{</span><span class="nv">url_path</span><span class="cp">}}</span></code></pre></figure>

<p>If you also want the <strong>get parameters</strong> you can use the simpler function:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span><span class="nv">url_parts.absolute_uri</span><span class="cp">}}</span></code></pre></figure>

<p>Doing the latter is easy in Vanilla Django using  “build_absolute_uri”. The former requires you to add the domain and path after “http://” or “https://” depending whether the request is secured or not.</p>

<p>(re)direct your users after login
Note that if you want to use the current page to create a login button that redirects after authentication you will want to use the “full_url”. Your template code should look like:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{%</span> <span class="nv">url</span> <span class="s2">"login"</span> <span class="cp">%}</span>?next=<span class="cp">{{</span><span class="nv">url_parts.full_url</span><span class="cp">}}</span></code></pre></figure>

<p>The default Django auth login view handles the redirect for you using the “next” get parameter.</p>

<h2 id="domain-or-host-name">Domain or host name</h2>
<p>If you use a rendered template outside of your website you can’t just use relative paths. So you’ll need the domain name of the current site. The site framework does this for you, but it’s a hassle and prone to errors because configuration is stored in the database. To get the domain name in the template use:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span><span class="nv">url_parts.domain</span><span class="cp">}}</span></code></pre></figure>

<p>Simple enough right? So if you for example use this to add an image in your outgoing emails, you’ll want to do:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://</span><span class="cp">{{</span><span class="nv">url_parts.domain</span><span class="cp">}}{%</span> <span class="nv">static</span> <span class="s2">"img/my-brand-logo.png"</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">alt=</span><span class="s">"My brand logo"</span> <span class="nt">/&gt;</span></code></pre></figure>

<h2 id="protocol-port-query">Protocol, port, query</h2>
<p>Finally the infrequently required URL parts. In some rare cases you might want to extract some very specific information from the URL. You can obtain the protocol (“http://” or “https://”) by:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span><span class="nv">url_parts.protocol</span><span class="cp">}}</span></code></pre></figure>

<p>The port can be extruded from the request is certain situations (not all) by:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span><span class="nv">url_parts.port</span><span class="cp">}}</span></code></pre></figure>

<p>Finally you might just want to get the query part of the URL, you know, that part behind the “?” with the get parameters:</p>

<figure class="highlight"><pre><code class="language-django" data-lang="django"><span class="cp">{{</span><span class="nv">url_parts.query</span><span class="cp">}}</span></code></pre></figure>

<h2 id="convenient-bits-and-pieces">Convenient bits and pieces</h2>
<p>So, what we aimed to create was a <a href="https://github.com/RRMoelker/django-full-url">small tool</a> that makes using URL bits and pieces a bit more convenient than the Django way. We use it on <a href="https://codecook.io">our site</a> for static share links, login redirects and email images. We hope you will be able to use it as well. And please let us know if you would like a feature or found a bug.</p>

  </div>

</article>

    </main>

    <footer class="site-footer" itemscope="" itemtype="http://schema.org/Corporation">
  <div class="container">
    <div class="footer-block"
        itemprop="address" 
        itemscope="" 
        itemtype="http://schema.org/PostalAddress">
      <h4 class="show-for-sr">Contact</h4>
      <a 
        href="https://www.google.com/maps/place/Kremerpad+11,+Hilversum,+Netherlands/@52.242604,5.1749074,17"
        title="Address in Google maps" 
        itemprop="address"
        itemscope=""
        itemtype="http://schema.org/PostalAddress">
        <span itemprop="name"><strong>DreamOnward</strong></span><br>
        <span itemprop="streetAddress">Kremerpad 11</span><br>
        <span itemprop="postalCode">1222 DB</span> <span itemprop="addressLocality">Hilversum</span>
      </a>
    </div>

    <div class="footer-block">
      <h4 class="show-for-sr">Media</h4>
      <ul class="social-media-list">
        
        <li>
          <a href="https://github.com/rrmoelker"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">rrmoelker</span></a>

        </li>
        

        
        <li>
          <a href="https://www.linkedin.com/company/dreamonward">
	<span class="icon"><svg viewBox="0 0 480 480"><path id="LinkedIn" d="M430.117,261.543V420.56h-92.188V272.193c0-37.271-13.334-62.707-46.703-62.707   c-25.473,0-40.632,17.142-47.301,33.724c-2.432,5.928-3.058,14.179-3.058,22.477V420.56h-92.219c0,0,1.242-251.285,0-277.32h92.21   v39.309c-0.187,0.294-0.43,0.611-0.606,0.896h0.606v-0.896c12.251-18.869,34.13-45.824,83.102-45.824   C384.633,136.724,430.117,176.361,430.117,261.543z M52.183,9.558C20.635,9.558,0,30.251,0,57.463   c0,26.619,20.038,47.94,50.959,47.94h0.616c32.159,0,52.159-21.317,52.159-47.94C103.128,30.251,83.734,9.558,52.183,9.558z    M5.477,420.56h92.184v-277.32H5.477V420.56z"/></svg></span><span class="username">dreamonward</span>
</a>

        </li>
        

        

        <li>
          <a href="mailto:info@dreamonward.com"><span class="icon"></span> info@dreamonward.com</a>
        </li>
      </ul>
    </div>


    <div class="footer-block contact" >
      <h4 class="show-for-sr">Info</h4>
      <span>KvK</span> <span>56017235</span><br>
      <span>General Terms and Conditions:
        <a href="/assets/terms/AV_DreamOnward_EN_2016-10-03.pdf">EN</a>
        <a href="/assets/terms/AV_DreamOnward_NL_2016-10-03.pdf">NL</a></span>
    </div>
  </div>


</footer>

  </body>

  <script src="/assets/vendor/lightbox/js/lightbox-plus-jquery.min.js"></script>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83787018-1', 'auto');
  ga('send', 'pageview');

</script>
</html>
