<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>WiPy getting started | DreamOnward</title>
  <meta name="description" content="Recently I created a cat food dispenser using the Python programmable board, the WiPy. While working on that I noticed that the device requires quite some in...">

  <!-- google analytics will only hit DNS on script execution, prefetch DNS -->
  <link rel="dns-prefetch" href="//www.google-analytics.com">
  <!-- google font will load additional files from other domain, prefetch DNS -->
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed" rel="stylesheet">

  <link type="text/css" rel="stylesheet" href="/assets/main-c386668b6c883d7ba6c52f138a1514809de4fd68d03fe2ef883b611370cb622e.css">
  <link type="text/css" rel="stylesheet" href="/assets/syntax-pygments-306491d01ec67c312c7391230abbf00e22dbdb2a9c283cb4cf00dc270ce28162.css">
  <link href="/assets/vendor/lightbox/css/lightbox.min.css" rel="stylesheet">
  <link rel="canonical" href="https://dreamonward.com/2016/07/18/wipy-getting-started-wipy-getting-started/">
</head>


  <body>
    <header class="banner" role="banner">
  <nav class="container site-nav">

    <a class="site-logo-space" href="/">
      <div class="site-logo">
        <img src="/assets/img/DreamOnward_logo_v1-800x800.png" height="60" srcset="/assets/img/DreamOnward_logo_v1-800x800.png 1x, /assets/img/DreamOnward_logo_v1-800x800.png 2x, /assets/img/DreamOnward_logo_v1-800x800.png 3x"> 
      </div>
      <div class="site-header-titles">
        <h1 class="site-header-title">DreamOnward</h1>
        <span class="site-header-subtitle">Full stack web development</span>
      </div>
    </a>

    <ul>
      
        
        <li>
          <a href="/projects">Projects</a>
        </li>
        
      
    </ul>
  </nav>


</header>


    <main class="page-content" aria-label="Content">
    <article class="post container" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">WiPy getting started</h1>
    <p class="post-meta">
    	<time datetime="2016-07-18T00:00:00+00:00" itemprop="datePublished">Jul 18, 2016</time>
	</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Recently I created a <a href="/2016/07/25/micro-python-for-your-cat-wipy-food-dispenser/">cat food dispenser</a> using the Python programmable board, the WiPy. While working on that I noticed that the device requires quite some initial setup to get started. We will go through all the necessary steps to get you developing quickly and effectively.</p>

<h2 id="what-is-this-wipy">What is this “WiPy”?</h2>

<figure class="img-medium img-right">
<img src="/2016/07/18/wipy-getting-started-wipy-getting-started/wipy_dimensions.jpg" alt="WiPy chip in center with Apple USB adapter as reference." />
<figcaption>WiPy chip in center with Apple USB adapter as reference.</figcaption>
</figure>

<p>The WiPy started as a <a href="https://www.kickstarter.com/projects/wipy/the-wipy-the-internet-of-things-taken-to-the-next/description#h:the-internet-of-thin">Kickstarter project</a> a while back.
It is unique in that it has WiFi and runs Python without the overhead of a full operating system. And with a lineup of devices supporting LoRaWAN, cellular and a combination of those. It has some real potential in being the brain for many of your hobby IoT and production projects.</p>

<p>There are a few drawbacks you can expect from a new device. It uses insecure connections (Telnet and FTP). It supports only a single FTP connection. And the documentation is scattered. I hope this post will help you get past the documentation issue and help you to get started using the WiPy.</p>

<h2 id="the-wipy-development-abcs">The WiPy development ABCs</h2>

<p>When getting started with the WiPy there are a few key things you should know/do:</p>

<ol>
  <li>Get to know the board</li>
  <li>Connect the WiPy to local WiFi</li>
  <li>Setting up file editing and uploading</li>
  <li>Learning how to do basic operations such as rebooting and reading stdout.</li>
</ol>

<p>You can use the Pymakr IDE to simplify parts of this initial setup. But, I like a bit more control. So we’ll look at setting up a development environment with a text editor and basic command line tools.</p>

<h2 id="the-wipy-board">The WiPy board</h2>

<p>The WiPy board has 24 GPIO pins, a heartbeat LED, a reset button and some internal timers. The memory contains a directory, “<strong>/flash</strong>” that contains the files “<strong>boot.py</strong>” and “<strong>main.py</strong>”. They execute in order on boot. Later we will edit “<strong>boot.py</strong>” to configure WiFi. And we’ll make the heartbeat LED blink by changing “<strong>main.py</strong>”.</p>

<p>To change the files we’ll connect to the FTP server on the device. And we’ll connect to the telnet server to read the programs output and perform reboots. But first we’ll have to power the device.</p>

<p>I power the WiPy by supplying USB power to the expansion board. Or you can supply power directly to the board through VIN or 3V3. See <a href="https://micropython.org/resources/docs/en/latest/wipy/wipy/tutorial/intro.html#powering-by-an-external-power-source">WiPy documentation on powering by an external power source</a> how to use direct power.</p>

<h2 id="connect-to-local-wifi">Connect to local WiFi</h2>

<p>When powered, the WiPy sets up an a WiFi access point that you can join with your development machine. While this connects you to the WiPy, it also disconnects you from your local WiFi. That in turn will likely disconnect you from the internet. This means you’ll have to switch a lot during development. So really the first thing to do is configure the WiPy to join your local WiFi. That way you can develop and access your Facebook at the same time.</p>

<p>The WiPy provides <a href="https://micropython.org/resources/docs/en/latest/wipy/wipy/general.html#wlan-default-behaviour">an access point</a> with the name “<strong>wipy-wlan-&lt;something&gt;</strong>” when powered. Join this network with the password “<strong>www.wipy.io</strong>”. Once connected you should be able to ping the device on this network at the address “<strong>192.168.1.1</strong>”.</p>

<p>We will change the ”<strong>boot.py</strong>” file on the WiPy to join our local WiFi network. First create a file ”<strong>boot.py</strong>” with the following contents:</p>

<noscript><pre># boot.py -- run on boot-up
# can run arbitrary Python, but best to keep it minimal
#
# WiPy WiFi setup, augmented code from:
# http://micropython.org/resources/docs/en/latest/wipy/wipy/tutorial/wlan.html#assigning-a-static-ip-address-when-booting

import machine
from network import WLAN

IP = &#39;192.168.1.42&#39;
SUBNET = &#39;255.255.255.0&#39;
GATEWAY = &#39;192.168.1.1&#39;
DNS_SERVER = &#39;8.8.8.8&#39;
SSID = &#39;myOwnWifiName&#39;
WIFI_PASS = &#39;correcthorsebatterystaple&#39;

wlan = WLAN()

if machine.reset_cause() != machine.SOFT_RESET:
    wlan.init(WLAN.STA)
    wlan.ifconfig(config=(IP, SUBNET, GATEWAY, DNS_SERVER))

if not wlan.isconnected():
    wlan.connect(SSID, auth=(WLAN.WPA2, WIFI_PASS), timeout=5000)

    while not wlan.isconnected():
        machine.idle()  # save power while waiting
</pre></noscript>
<script src="https://gist.github.com/RRMoelker/f2e088732834c5050e4faec0c9982c1b.js"> </script>

<p>Next upload this new file to the WiPy using FTP. Open the connection using either <code class="highlighter-rouge">ftp 192.168.1.1</code> or <code class="highlighter-rouge">open 192.168.1.1</code> (depending on your OS). Login with user “<strong>micro</strong>” and password “<strong>python</strong>”. Then issue the following commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd flash
send boot.py
</code></pre>
</div>

<p>Finally close the connection using <code class="highlighter-rouge">CTRL-D</code>.
FTP upload of new “<strong>boot.py</strong>” file to WiPy.</p>

<figure>
<img src="/2016/07/18/wipy-getting-started-wipy-getting-started/wipy_ftp_upload.gif" alt="FTP upload of new “**boot.py**” file to WiPy." />
<figcaption>FTP upload of new “**boot.py**” file to WiPy.</figcaption>
</figure>

<p>That should do it. Reset the WiPy (cycle power or hit the tiny reset button) and the WiPy should join your local network. See if it works by pinging: <code class="highlighter-rouge">ping 192.168.1.48</code>.</p>

<p>Uploading an incorrect “<strong>boot.py</strong>” is a good way to lock yourself out. If that happens, fear not, you can recover using “<strong>safe boot</strong>”.</p>

<h2 id="safe-boot">Safe boot</h2>

<p>If you lock yourself out of your WiPy, you can perform a “<a href="https://micropython.org/resources/docs/en/latest/wipy/wipy/general.html#wipy-boot-modes">safe boot</a>”. This will start the WiPy without executing the “<strong>boot.py</strong>” script meaning you’ll be able to connect to WiPy access point.</p>

<figure>
<img src="/2016/07/18/wipy-getting-started-wipy-getting-started/wipy_soft_reset_wiring.gif" alt="Pull up pin 28 during boot to go into safe boot and bypass “**boot.py**”." />
<figcaption>Pull up pin 28 during boot to go into safe boot and bypass “**boot.py**”.</figcaption>
</figure>

<p>Briefly connecting the 3v3 pin to pin 28 while hitting the reset button will perform a safe boot.</p>

<p>This will skip the user defined “<strong>boot.py</strong>” and “<strong>main.py</strong>” scripts. In turn this restores the default WiFi access point. The changes don’t persist. If you reboot the WiPy without pulling up pin 28 it will start using the “<strong>boot.py</strong>” and “<strong>main.py</strong>” files</p>

<p>From a safe boot you can upload the revised and now hopefully corrected “<strong>boot.py</strong>”. See if the revised file lets your WiPy join your WiFi after reboot.</p>

<h2 id="ftp-upload">FTP upload</h2>

<p>To edit the Python files locally and easily execute them on the remote requires some work. You can use the same technique to send files as we did when sending the revised “<strong>boot.py</strong>”. But I prefer a bit more automated approach.</p>

<p>I use IntelliJ for development, so we’ll look at how you can setup a remote host for easy file upload. We will also look at the command line tool “<strong>lftp</strong>” to script the upload process.</p>

<h2 id="intellij-remote-host">IntelliJ remote host</h2>

<p>After configuring a remote host in IntelliJ it is easy to upload or even sync a local folder to the WiPy. Start by opening “<strong>Tools &gt; Deployment &gt; Configuration</strong>”. Configure it like so:</p>

<figure>
<img src="/2016/07/18/wipy-getting-started-wipy-getting-started/wipy_IntelliJ_remote_host_config_A.png" alt="WiPy IntelliJ remote host config, password is “**python**”" />
<figcaption>WiPy IntelliJ remote host config, password is “**python**”</figcaption>
</figure>

<p>Use the advanced settings:</p>

<figure>
<img src="/2016/07/18/wipy-getting-started-wipy-getting-started/wipy_IntelliJ_remote_host_config_B.png" alt="IntelliJ WiPy remote host advanced settings. FTP connection limit is set to 1 because the WiPy only supports a single FTP connection at time of writing." />
<figcaption>IntelliJ WiPy remote host advanced settings. FTP connection limit is set to 1 because the WiPy only supports a single FTP connection at time of writing.</figcaption>
</figure>

<p>After the initial setup local folders can be mapped to remote folders to enable auto upload. But I like to manually upload changes.</p>

<figure>
<img src="/2016/07/18/wipy-getting-started-wipy-getting-started/wipy_IntelliJ_remote_host_config_C.png" alt="" />
<figcaption></figcaption>
</figure>

<p>Manual upload works by execute the command “<strong>Upload to… [Deployment]</strong>”. Or by using the shortcut: <code class="highlighter-rouge">CMD-LSHIFT-ALT-X</code> (keybindings may vary). Then pick the WiPy remote as the target and your file will be uploaded.</p>

<h2 id="lftp-upload">lftp upload</h2>

<p>lftp is a command line tool that makes it easy to upload code through simple scripts. The following bash script sets up a connection and sends the “<strong>main.py</strong>” file to the WiPy:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>

<span class="c"># Save as file upload.sh</span>
<span class="c"># first argument is WiPy IP</span>

lftp -u micro,python <span class="nv">$1</span> <span class="sh">&lt;&lt; EOF

cd /flash
put main.py

bye
</span><span class="err">EOF</span></code></pre></figure>

<p>You can use it to upload your “<strong>main.py</strong>” file using:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sh ./upload.sh 192.168.1.48
</code></pre>
</div>

<h2 id="telnet">Telnet</h2>

<p>During development it is useful to have a Telnet session open to the WiPy. It shows you print statement output. And you can reset the WiPy without having to cycle the power or press the tiny reset button.</p>

<p>To get a Telnet session up, use the following command and login with user “<strong>micro</strong>” and password “<strong>python</strong>”:</p>

<p class="indent-code">telnet 192.168.1.42</p>

<p>To perform a soft reboot hit <code class="highlighter-rouge">CTRL-D</code>. It will restart the WiPy and execute the “<strong>main.py</strong>” script. Any print statement output will be directly visible in your shell.</p>

<p>I haven’t looked into debugging configurations that would allow breakpoints, call stack and variable inspection. Though it certainly would be useful. If anyone figures out how to setup this kind of debugging please give a ping back.</p>

<h2 id="actual-coding">Actual coding</h2>

<p>So after all these configuration steps we have an environment to quickly develop for the WiPy.</p>

<h3 id="hello-world">Hello world</h3>

<p>To test your setup, try programming a simple hello world application using the on board heartbeat LED. Next to the FTP upload script from before create a new file “<strong>main.py</strong>”:</p>

<noscript><pre>import time
import wipy

while True:
  wipy.heartbeat(False) # disable the heartbeat
  time.sleep_ms(100)
  wipy.heartbeat(True) # enable the heartbeat
  time.sleep_ms(100)</pre></noscript>
<script src="https://gist.github.com/RRMoelker/54233f10c50bdb146d2b4afbef2f04cc.js"> </script>

<p>Upload the script with:</p>

<p class="indent-code">sh upload.sh 192.168.1.48</p>

<p>Now execute the “<strong>main.py</strong>” file by either cycling the power, hitting the reset button or hitting <code class="highlighter-rouge">CTRL-D</code> in a Telnet session. The result should be a fast blinking heartbeat LED.</p>

<h3 id="hello-world-pin">Hello world pin</h3>

<p>The heartbeat LED is connected to pin 25. So to get acquainted with the PIN API, here is the same program using PIN configuration:</p>

<noscript><pre>import time
from machine import Pin

led = Pin(&#39;GP25&#39;, mode=Pin.OUT)

while True:
  led(0)  # turn off the heartbeat LED
  time.sleep_ms(100)
  led(1)  # turn on the heartbeat LED
  time.sleep_ms(100)
</pre></noscript>
<script src="https://gist.github.com/RRMoelker/58537d48fa3ec1a7828c8385b98e50e5.js"> </script>

<p>The program puts pin 25 in output mode and controls the output. Of course you can also use these GPIO pins to read an signal and use internal resistors to pull up or down the input. For these operations and more, see <a href="http://micropython.org/resources/docs/en/latest/wipy/library/machine.Pin.html#class-pin-control-i-o-pins">the documentation</a>.</p>

<h2 id="where-to-go-from-here">Where to go from here</h2>

<p>This should have gotten you started with a basic setup for developing with a WiPy. I’ll leave you with a few links to specific documentation resources to help you on with your projects:</p>

<ul>
  <li><a href="http://micropython.org/resources/docs/en/latest/wipy/wipy/quickref.html">Basic API calls</a></li>
  <li><a href="https://raw.githubusercontent.com/wipy/wipy/master/docs/PinOUT.png">Pin out image</a></li>
  <li><a href="http://micropython.org/resources/docs/en/latest/wipy/library/index.html#python-standard-libraries-and-micro-libraries">Available Python, MicroPython and WiPy libraries</a></li>
  <li>Control servos using the board timers: <a href="/2016/07/25/micro-python-for-your-cat-wipy-food-dispenser/">MicroPython for your cat</a></li>
</ul>

  </div>

</article>

    </main>

    <footer class="site-footer" itemscope="" itemtype="http://schema.org/Corporation">
  <div class="container">
    <div class="footer-block"
        itemprop="address" 
        itemscope="" 
        itemtype="http://schema.org/PostalAddress">
      <h4 class="show-for-sr">Contact</h4>
      <a 
        href="https://www.google.com/maps/place/Kremerpad+11,+Hilversum,+Netherlands/@52.242604,5.1749074,17"
        title="Address in Google maps" 
        itemprop="address"
        itemscope=""
        itemtype="http://schema.org/PostalAddress">
        <span itemprop="name"><strong>DreamOnward</strong></span><br>
        <span itemprop="streetAddress">Kremerpad 11</span><br>
        <span itemprop="postalCode">1222 DB</span> <span itemprop="addressLocality">Hilversum</span>
      </a>
    </div>

    <div class="footer-block">
      <h4 class="show-for-sr">Media</h4>
      <ul class="social-media-list">
        
        <li>
          <a href="https://github.com/rrmoelker"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">rrmoelker</span></a>

        </li>
        

        
        <li>
          <a href="https://www.linkedin.com/company/dreamonward">
	<span class="icon"><svg viewBox="0 0 480 480"><path id="LinkedIn" d="M430.117,261.543V420.56h-92.188V272.193c0-37.271-13.334-62.707-46.703-62.707   c-25.473,0-40.632,17.142-47.301,33.724c-2.432,5.928-3.058,14.179-3.058,22.477V420.56h-92.219c0,0,1.242-251.285,0-277.32h92.21   v39.309c-0.187,0.294-0.43,0.611-0.606,0.896h0.606v-0.896c12.251-18.869,34.13-45.824,83.102-45.824   C384.633,136.724,430.117,176.361,430.117,261.543z M52.183,9.558C20.635,9.558,0,30.251,0,57.463   c0,26.619,20.038,47.94,50.959,47.94h0.616c32.159,0,52.159-21.317,52.159-47.94C103.128,30.251,83.734,9.558,52.183,9.558z    M5.477,420.56h92.184v-277.32H5.477V420.56z"/></svg></span><span class="username">dreamonward</span>
</a>

        </li>
        

        

        <li>
          <a href="mailto:info@dreamonward.com"><span class="icon"></span> info@dreamonward.com</a>
        </li>
      </ul>
    </div>


    <div class="footer-block contact" >
      <h4 class="show-for-sr">Info</h4>
      <span>KvK</span> <span>66495725</span><br>
      <span>General Terms and Conditions:
        <a href="/assets/terms/AV_DreamOnward_EN_2016-10-03.pdf">EN</a>
        <a href="/assets/terms/AV_DreamOnward_NL_2016-10-03.pdf">NL</a></span>
    </div>
  </div>


</footer>

  </body>

  <script src="/assets/vendor/lightbox/js/lightbox-plus-jquery.min.js"></script>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83787018-1', 'auto');
  ga('send', 'pageview');

</script>
</html>
